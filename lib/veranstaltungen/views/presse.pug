extends ../../../views/layout
include ../../../views/formComponents

block title
  | Veranstaltung

block content
  -var presse = veranstaltung.presse()

  form#presseform(action='/veranstaltungen/submitWithImage' + '?_csrf=' + encodeURIComponent(csrf_token), method='post', enctype='multipart/form-data')
    +csrf
    +hidden('id', veranstaltung.id())
    fieldset
      .row
        .col-md-12
          +submitButtonsFor(veranstaltung, 'presse')
          .page-header
            h2 Pressetext für #{veranstaltung.datumForDisplay()}<br>
              small #{veranstaltung.kopf().titel()} im #{veranstaltung.kopf().ort()}
      .row
        .col-md-12
          +legendMitBody('event', 'Pressematerial', null, 'color-presse')
            .row
              .col-md-6
                +hightextarea('presse[text]', 'Text', presse.text(), 'Formatierter Text für die Pressemitteilung')
              .col-md-6
                #preview
      .row
        .col-md-6
          input#bildupload.file-loading(name='image', type='file', data-preview-file-type="image")
        .col-md-6
          if (presse.image())
            p.form-control-static: b Aktuell gewählt: #{presse.image()}
      .row
        .col-md-12
          hr
          +submitButtonsFor(veranstaltung, 'presse')

block scripts
  script.
    $(document).ready(function () {
      var textarea = $('#presse\\[text\\]');
      var preview = $('#preview');

      function updateForText() {
        $.ajax(encodeURIComponent('#{veranstaltung.fullyQualifiedUrl()}/pressePreview'), {data: {text: textarea.val()}})
         .done(function (result) {
           if (result) {
             preview.html(result);
           }
         })
      }

      textarea.keyup(updateForText);
      updateForText();
      $('#bildupload').fileinput({
        language: 'de',
        theme: 'fa',
        showPreview: false,
        maxFilePreviewSize: 10240
      });
    });
