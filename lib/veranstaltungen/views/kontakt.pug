include ../../../views/formComponents

mixin kontakt(veranstaltung, kontakte, labelForLegend, name)
  -var derkontakt = veranstaltung[name]()
  legend
    a(data-toggle='collapse', href='#' + name) #{labelForLegend}
  .collapse.in(id=name)
    .row
      .col-sm-6
        .form-group
          label.control-label(for='auswahl') Auswahl:
          select.form-control(name=name + '[auswahl]', id=name + '[auswahl]')
            for kontakt in kontakte
              option(value=kontakt.name, selected = (derkontakt !== undefined && derkontakt.name() === kontakt.name)) #{kontakt.name}
      .col-sm-6
        +text(name + '[name]', 'Name', derkontakt.name())
    .row
      .col-sm-6
        +text(name + '[ansprechpartner]', 'Ansprechpartner', derkontakt.ansprechpartner())
        +text(name + '[telefon]', 'Telefon', derkontakt.telefon())
        +text(name + '[email]', 'E-Mail', derkontakt.email())
      .col-sm-6
        +textareaPure(name+ '[adresse]', 'Adresse', derkontakt.adresse())

mixin kontaktScript(name)
  script.
    var auswahl = $('##{name}\\[auswahl\\]');
    var nameText = $('##{name}\\[name\\]');
    var ansprechpartnerText = $('##{name}\\[ansprechpartner\\]');
    var telefonText = $('##{name}\\[telefon\\]');
    var emailText = $('##{name}\\[email\\]');
    var adresseText = $('##{name}\\[adresse\\]');

    function updateForAuswahl() {
      $.ajax('/optionen/#{name}ForAuswahl', {data: {auswahl: auswahl.val()}})
       .done(function (result) {
         if (result) {
           nameText.val(result.name);
           ansprechpartnerText.val(result.ansprechpartner);
           telefonText.val(result.telefon);
           emailText.val(result.email);
           adresseText.val(result.adresse);
         }
       })
    }

    auswahl.change(updateForAuswahl);
    
