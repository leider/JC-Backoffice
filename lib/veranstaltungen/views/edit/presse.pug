extends ../../../../views/layout
include ../../../../views/formComponents
include mixins

block title
  | Veranstaltung

block content
  -var presse = veranstaltung.presse()
  .col-12
    form#presseform(action='/veranstaltungen/submit', method='post')
      +csrf
      +hidden('id', veranstaltung.id())
      +hidden('kopf[confirmed]', veranstaltung.kopf().confirmed() ? 'on' : undefined)
      fieldset
        .row
          .col-12
            .page-header
              +submitButtonsFor(veranstaltung, 'presse', true)
              h2.text-presse #{veranstaltung.kopf().titel()} <br>
                small.text-presse am #{veranstaltung.datumForDisplayShort()}
            +tabsFor(veranstaltung, 'presse')
            .tab-content
              .tab-pane.show.active
                +legendMitBody('event', 'Pressematerial', null, 'presse')
                  .row.mb-3
                    .col-12.col-md-3
                      +checkbox('presse[checked]', 'Ist so OK', presse.checked())
                  .row
                    .col-md-6
                      +text('presse[jazzclubURL]', 'URL-Suffix bei jazzclub.de', presse.jazzclubURL())
                      +hightextarea('presse[text]', 'Text', presse.text(), 'Formatierter Text f√ºr die Pressemitteilung')
                      +uploader('imageupload', 'Datei', 'image/*', presse.image(), {id: veranstaltung.id(), typ: 'pressefoto'})
                      +singleselect('presse[existingbild]', 'Vorhandene Bilder', null, bildernamen)
                    .col-md-6
                      #preview

block head
  link(rel='stylesheet', href='/stylesheets/fileinput.css')

block scripts
  script(src='/clientscripts/fileinput.min.js')
  script(src='/clientscripts/bootstrap-markdown.min.js')
  script.
    $(document).ready(function () {
      var textarea = $('#presse\\[text\\]');
      var jazzclubURL = $('#presse\\[jazzclubURL\\]');
      var preview = $('#preview');

      function updateForText() {
        $.ajax('#{veranstaltung.fullyQualifiedUrl().replace('\'', '\\\'')}' + '/pressePreview', {data: {text: textarea.val(), jazzclubURL: jazzclubURL.val()}})
         .done(function (result) {
           if (result) {
             preview.html(result);
           }
         })
      }

      jazzclubURL.keyup(updateForText);
      textarea.keyup(updateForText);
      updateForText();
    });
