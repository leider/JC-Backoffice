extends ../../../../views/layout
include ../../../../views/formComponents
include mixins

block title
  | Veranstaltung

block content
  -var presse = veranstaltung.presse()
  .col-12
    form#presseform(action='/veranstaltungen/submit', method='post')
      +editHeader(veranstaltung, 'presse')
        .col-12
          +legendMitBody('event', 'Pressematerial', null, 'presse')
            .row.mb-3
              .col-12.col-md-3
                +checkbox('presse[checked]', 'Ist so OK', presse.checked())
            .row
              .col-md-6
                +text('presse[jazzclubURL]', 'URL-Suffix bei jazzclub.de', presse.jazzclubURL())
                +hightextarea('presse[text]', 'Text', presse.text(), 'Formatierter Text f√ºr die Pressemitteilung')
                +textarea('presse[originalText]', 'Unredigierter Text', presse.originalText(), 'Text, wie er unredigiert vorliegt')
                +uploader('imageupload', 'Datei', 'image/*', presse.image(), {id: veranstaltung.id(), typ: 'pressefoto'})
                +singleselect('presse[existingbild]', 'Vorhandene Bilder', null, bildernamen)
              .col-md-6
                #preview

block head
  link(rel='stylesheet', href='/stylesheets/fileinput.css')

block scripts
  script(src='/clientscripts/fileinput.min.js')
  script(src='/clientscripts/bootstrap-markdown.min.js')
  script.
    $(document).ready(function () {
      var textarea = $('#presse\\[text\\]');
      var jazzclubURL = $('#presse\\[jazzclubURL\\]');
      var preview = $('#preview');

      function updateForText() {
        $.ajax('#{veranstaltung.fullyQualifiedUrl().replace('\'', '\\\'')}' + '/pressePreview', {data: {text: textarea.val(), jazzclubURL: jazzclubURL.val()}})
         .done(function (result) {
           if (result) {
             preview.html(result);
           }
         })
      }

      jazzclubURL.keyup(updateForText);
      textarea.keyup(updateForText);
      updateForText();
    });
