extends ../../../../views/layout
include ../../../../views/formComponents
include werbungMixins
include staffMixins
include mixins

block title
  | Veranstaltung

block content
  -var kosten = veranstaltung.kosten()
  .col-12
    form#ausgabenform(action='/veranstaltungen/submit', method='post')
      +csrf
      +hidden('id', veranstaltung.id())
      +hidden('kopf[confirmed]', veranstaltung.kopf().confirmed() ? 'on' : undefined)
      fieldset
        .row
          .col-12
            .page-header
              +submitButtonsFor(veranstaltung, 'ausgaben')
              h2 Kosten f√ºr #{veranstaltung.datumForDisplayMitKW()}<br>
                small #{veranstaltung.kopf().titel()} #{veranstaltung.kopf().presseIn()}
              +checkbox('kosten[checked]', 'Ist so OK', kosten.checked())
        .row
          .col-md-6
            +legendMitBody('backline', 'Backline und Technik', 'backlinePreis', 'costs')
              .row
                .col-sm-9
                  +text('kosten[rider]', 'Rider', kosten.rider())
                  +uploader('riderupload', 'Datei', null, kosten.dateirider(), {id: veranstaltung.id(), typ: 'rider'})
              .row
                .col-sm-9
                  +editableMultiselect('kosten[backlineJazzclub]', 'Jazzclub', kosten.backlineJazzclub(), optionen.backlineJazzclub())
              .row
                .col-sm-9
                  +editableMultiselect('kosten[backlineRockshop]', 'Rockshop', kosten.backlineRockshop(), optionen.backlineRockshop())
                .col-sm-3
                  +currency('kosten[backlineEUR]', 'Betrag', kosten.backlineEUR())
              .row
                .col-sm-9
                  +text('kosten[technikJazzclub]', 'Technik Jazzclub', kosten.technikJazzclub())
              .row
                .col-sm-9
                  +text('kosten[technikAngebot1]', 'Technik Angebot 1', kosten.technikAngebot1())
                .col-sm-3
                  +currency('kosten[technikAngebot1EUR]', 'Betrag', kosten.technikAngebot1EUR())
              .row
                .col-sm-9
                  +text('kosten[technikAngebot2]', 'Technik Angebot 2', kosten.technikAngebot2())
                .col-sm-3
                  +currency('kosten[technikAngebot2EUR]', 'Betrag', kosten.technikAngebot2EUR())
            +legendMitBody('saalmiete', 'Saalmiete', 'saalmietePreis', 'costs')
              .row
                .col-sm-9
                  +text('kosten[saal]', 'Location (von anderer Seite)', veranstaltung.kopf().ort(), null,null, true)
                .col-sm-3
                  +currency('kosten[saalmiete]', 'Betrag', kosten.saalmiete())
          .col-md-6
            +staff(veranstaltung.staff(), allUsers)
            +marketingUndPlakate(veranstaltung.werbung(), optionen)
        .row
          .col-12
            hr
            +submitButtonsFor(veranstaltung, 'ausgaben')

block head
  link(rel='stylesheet', href='/stylesheets/fileinput.css')

block scripts
  script(src='/clientscripts/fileinput.min.js')
  script.
    $(document).ready(function initAusgabenScript() {
      var backlineEUR = $('#kosten\\[backlineEUR\\]');
      var technikAngebot1EUR = $('#kosten\\[technikAngebot1EUR\\]');
      var technikAngebot2EUR = $('#kosten\\[technikAngebot2EUR\\]');

      function updateBacklinePreis() {
        setEuro($('#backlinePreis'), floatAmount(backlineEUR) + floatAmount(technikAngebot1EUR) + floatAmount(technikAngebot2EUR));
      }
      backlineEUR.keyup(updateBacklinePreis);
      technikAngebot1EUR.keyup(updateBacklinePreis);
      technikAngebot2EUR.keyup(updateBacklinePreis);
      updateBacklinePreis();

      var saalmiete = $('#kosten\\[saalmiete\\]');
      function updateSaalmietePreis() {
        setEuro($('#saalmietePreis'), floatAmount(saalmiete));
      }
      saalmiete.keyup(updateSaalmietePreis);
      updateSaalmietePreis();
    });

  +marketingUndPlakateScripts
  +staffScript
  script(src='/clientscripts/check-ausgabenform.js')
