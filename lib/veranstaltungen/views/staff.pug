include ../../../views/formComponents
  
mixin staffRow(optionen, staff, name, label)
  .row
    .col-xs-6
      +editableMultiselect('staff[' + name + ']', label, staff[name](), optionen[name]())
    .col-xs-3
      +currency('staff[' + name + 'EUR]', 'Betrag', staff[name + 'EUR']() || optionen[name + 'EUR']())
    .col-xs-3
      .form-group
        label.control-label Total:
        p: b
          +currencySpan(null, name + 'Total', 'form-control-static pull-right text-success')


mixin staffRowVerantwortlich(allUsers, staff, name, label)
  .row
    .col-xs-3
      +editableMultiselect('staff[' + name + ']', label, staff[name](), allUsers)
    .col-xs-3
      +editableMultiselect('staff[' + name + 'V]', 'Verantw.', staff[name + 'V'](), allUsers)
    .col-xs-3
      +currency('staff[' + name + 'EUR]', 'Betrag', staff[name + 'EUR']() || optionen[name + 'EUR']())
    .col-xs-3
      .form-group
        label.control-label Total:
        p: b
          +currencySpan(null, name + 'Total', 'form-control-static pull-right text-success')


mixin staffScriptFor(name)
  script.
    $(document).ready(function() {
      var #{name} = $('#staff\\[#{name}\\]');
      var #{name}EUR = $('#staff\\[#{name}EUR\\]');

      function update#{name}Total() {
        var result = #{name}.val().length * eurAmount(#{name}EUR);
        $('#' + '#{name}Total').autoNumeric('set', result);
        updateStaffTotal();
      }

      #{name}.change(update#{name}Total);
      #{name}.keyup(update#{name}Total);
      #{name}EUR.keyup(update#{name}Total);
      update#{name}Total();
    });

mixin staffScriptVerantwortlichFor(name)
  script.
    $(document).ready(function() {
      var #{name} = $('#staff\\[#{name}\\]');
      var #{name}EUR = $('#staff\\[#{name}EUR\\]');
      var #{name}V = $('#staff\\[#{name}V\\]');

      function update#{name}Total() {
        var result = (#{name}.val().length + #{name}V.val().length) * eurAmount(#{name}EUR);
        $('#' + '#{name}Total').autoNumeric('set', result);
        updateStaffTotal();
      }

      #{name}.change(update#{name}Total);
      #{name}.keyup(update#{name}Total);
      #{name}V.change(update#{name}Total);
      #{name}V.keyup(update#{name}Total);
      #{name}EUR.keyup(update#{name}Total);
      update#{name}Total();
    });

mixin staff(staff, optionen, allUsers)
  +legendMitBody('staff', 'Staff', 'staffPreis', 'color-costs')
    +staffRowVerantwortlich(allUsers, staff, 'techniker', 'Techniker')
    +staffRowVerantwortlich(allUsers, staff, 'kasse', 'Kasse')
    +staffRow(optionen, staff, 'merchandise', 'Merchandise')
    +staffRow(optionen, staff, 'fremdpersonal', 'Fremdpersonal')

mixin staffScript
  script.
    function updateStaffTotal() {
      const summe = eurAmount($('#technikerTotal')) + eurAmount($('#merchandiseTotal'))
        + eurAmount($('#kasseTotal')) + eurAmount($('#fremdpersonalTotal'));
      $('#staffPreis').autoNumeric('set', summe);
    }

  +staffScriptVerantwortlichFor('techniker')
  +staffScriptFor('merchandise')
  +staffScriptVerantwortlichFor('kasse')
  +staffScriptFor('fremdpersonal')
  
  

